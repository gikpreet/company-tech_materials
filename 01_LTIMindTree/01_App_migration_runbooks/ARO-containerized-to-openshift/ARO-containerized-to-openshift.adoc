= Managed RedHat OpenShiftë¥¼ Azure ARO(RedHat OpenShift)ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

== ë¬¸ì„œ ìš”ì•½

[cols="1,5", options="header"]
|===
|ë¬¸ì„œ í•­ëª©|í˜„ì¬ ê°€ì¹˜
|ë¬¸ì„œ ì œëª©|FACTORY_Runbook_Azure_RedHat_Openshift_Onprem_Containerized_Apps_To_Openshift
|í”„ë¡œê·¸ë¨|Cloud Acceleration Factory
|ë§ˆì§€ë§‰ìœ¼ë¡œ ìˆ˜ì •í•œ ë‚ ì§œ|27-03-2024
|ë§ˆì§€ë§‰ ê²€í†  ë‚ ì§œ|10-07-2024
|ìƒíƒœ|ìŠ¹ì¸
|ë¬¸ì„œ ì„¤ëª…|ì´ ë¬¸ì„œì—ì„œëŠ” Devopsë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¨í”„ë ˆë¯¸ìŠ¤ ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ARO í´ëŸ¬ìŠ¤í„°ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜/êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì§€ì¹¨ì„ ì œê³µí•©ë‹ˆë‹¤.
|===

== ë³€ê²½ ë¡œê·¸

== ëª©ì°¨

<<1. ì†Œê°œ>>

* <<1.1 Azure RedHat OpenShift(ARO)>>
* <<1.2 ì°¸ì¡° ì•„í‚¤í…ì²˜>>

<<2. ì—­í• ê³¼ ì±…ì„>>

<<3. ê³„íš>>

<<4. ì „ì œ ì¡°ê±´>>

<<5. ì‹¤í–‰>>

* <<5.1 OpenShift ì›¹ ì½˜ì†”, DockerFile ì „ëµ(ìˆ˜ë™), DockerHub ì´ë¯¸ì§€ ì‚¬ìš© AROì—ì„œ ì»¨í…Œì´ë„ˆí™” ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„>>
* <<5.2 AROì—ì„œ ì»¨í…Œì´ë„ˆí™”ë¨ ì•±ì„ ìœ„í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„, OpenShift ì›¹ ì½˜ì†” ì‚¬ìš©, Docklerfile ì „ëµ(ìˆ˜ë™), Azure Container Registry(ACR) ì´ë¯¸ì§€ ì‚¬ìš©>>
* <<5.3 OpenShift ì›¹ ì½˜ì†”ì„ ì‚¬ìš©í•œ ARO ì»¨í…Œì´ë„ˆí™” ì•± ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„, S2I(Source-to-Image) ì „ëµ(ìˆ˜ë™)>>
* <<5.4 OpenShift(OC) ëª…ë ¹ì¤„ì„ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™” ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„>>

<<6. DevOps íŒŒì´í”„ë¼ì¸>>

* <<6.1 OpenShift ë‚´ì¥ Tekton íŒŒì´í”„ë¼ì¸ì„ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™”ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„(ìˆ˜ë™ íŠ¸ë¦¬ê±°)>>
* <<6.2 OpenShift ë‚´ì¥ Tekton íŒŒì´í”„ë¼ì¸ì„ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™”ëœ ì•±ì„ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ëŠ” ë‹¨ê³„(ìë™ íŠ¸ë¦¬ê±°, GitHub ì›¹í›…)>>
* <<6.3 GibHub Actionsë¥¼ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™” ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„>>
* <<6.4 Azure DevOpsë¥¼ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™” ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„>>

<<7. ë¶€ë¡>>

== 1. ì†Œê°œ

ì´ ë¬¸ì„œì—ì„œëŠ” ARO(Azure RedHat OpenShift)ì— ëŒ€í•œ ê°„ëµí•œ ì†Œê°œ, ARO ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ„í•œ í•„ìˆ˜ êµ¬ì„± ìš”ì†Œ ë° ìƒ˜í”Œ ì»¨í…Œì´ë„ˆí™” ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ARO í´ëŸ¬ìŠ¤í„°ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ëŠ” ìì„¸í•œ ì ˆì°¨/ë‹¨ê³„ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

=== 1.1 Azure RedHat OpenShift(ARO)

Azure RedHat OpenShiftëŠ” Microsoftì™€ Red Hatì´ ê³µë™ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§ ë° ìš´ì˜í•˜ëŠ” ì£¼ë¬¸ì„± ê³ ê°€ìš©ì„± ì™„ì „ ê´€ë¦¬í˜• OpenShift í´ëŸ¬ìŠ¤í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤. KubernetersëŠ” Red Hat OpenShiftì˜ í•µì‹¬ì…ë‹ˆë‹¤. OpeenShiftëŠ” Kuberneteesë¥¼ ë³´ì™„í•˜ëŠ” ë¶€ê°€ê°€ì¹˜ ê¸°ëŠ¥ì„ ì œê³µí•˜ì—¬ ê°œë°œì ë° ìš´ì˜ì ê¸°ëŠ¥ì„ í¬ê²Œ ê°œì„ í•œ í„´í‚¤ PaaS(Container Platform as a Service)ë¡œ ë§Œë“­ë‹ˆë‹¤.

ë‹¤ìŒì€ AROì˜ ì£¼ìš” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

* Microsoftì™€ RedHatì´ ê³µë™ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§ ë° ìš´ì˜í•˜ëŠ” ì˜¨ë””ë§¨ë“œ ì™„ì „ ê´€ë¦¬í˜• OpenShift í´ëŸ¬ìŠ¤í„°
* ì¿ ë²„ë„¤í‹°ìŠ¤ - PaaS
* ì…€í”„ ì„œë¹„ìŠ¤, ì˜¨ë””ë§¨ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìŠ¤íƒ í”„ë¡œë¹„ì €ë‹
* í†µí•© ê°œë°œì ë„êµ¬
* ë³´ì•ˆ ë° ê·œì • ì¤€ìˆ˜
* í™•ì¥ì„± ë° ê°€ìš©ì„±
* í•˜ì´ë¸Œë¦¬ë“œ ë° ë©€í‹° í´ë¼ìš°ë“œ ì§€ì›
* Red Hat Enterprise Linux CoreOS(RHCOS)
* ìµœì‹  ì• í”Œë¦¬ì¼€ì´ì…˜ ì•„í‚¤í…ì²˜ ì§€ì›
* ê¸°ë³¸ ì œê³µ ìš´ì˜ì ë° ìš´ì˜ì í—ˆë¸Œ ì§€ì›
* ê¸°ë³¸ ì œê³µ CI/CD íŒŒì´í”„ë¼ì¸

=== 1.2 ì°¸ì¡° ì•„í‚¤í…ì²˜

image:./images/image01.png[]

== 2. ì—­í• ê³¼ ì±…ì„

[cols=5, options="header"]
|===
|ê³¼ì—…|ì±…ì„|ì±…ì„|ìƒë‹´|ì •ë³´
|í´ëŸ¬ìŠ¤í„° ìƒì„±|ê³ ê°/íŒŒíŠ¸ë„ˆ|ê³ ê°/íŒŒíŠ¸ë„ˆ|ê³ ê°/íŒŒíŠ¸ë„ˆ|Factory
|ê³µìœ í•  í‰ê°€ ë³´ê³ ì„œ|ê³ ê°/íŒŒíŠ¸ë„ˆ|ê³ ê°/íŒŒíŠ¸ë„ˆ|ê³ ê°/íŒŒíŠ¸ë„ˆ|Factory
|ë¶„ì„ ë³´ê³ ì„œ ì‘ì„±|Factory|Factory|ê³ ê°/Factory|ê³ ê°/Factory
|ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬|Factory/ê³ ê°|Factory/ê³ ê°|Factory/ê³ ê°|Factory/ê³ ê°
|===

== 3. ê³„íš

* í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ì•¡ì„¸ìŠ¤ ë³´ì¥
* Azure êµ¬ë…ì— ëŒ€í•œ Controbutor ì—­í• 

== 4. ì „ì œ ì¡°ê±´

* ë§ˆì´ê·¸ë ˆì´ì…˜í•  ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìµœì¢…í™”(Wave ê³„íš)
* Azure ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬ë¥¼ ì‹¤í–‰í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ í‰ê°€/ìˆ˜ë™ ê²€ìƒ‰ - VMì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜, ì„œë¹„ìŠ¤ ë° ì¢…ì†ì„± ì‹ë³„
* ëœë”© ì¡´ Azure Red Hat OpenShift í´ëŸ¬ìŠ¤í„° ìƒì„±
* AROì—ì„œ ë„¤íŠ¸ì›Œí‚¹, ì €ì¥ì†Œ, ë³´ì•ˆ ì„¤ì •ì„ êµ¬ì„±í•©ë‹ˆë‹¤.
* í´ëŸ¬ìŠ¤í„° ì•¡ì„¸ìŠ¤ ë° ê¸°ì—¬ì ì—­í•  ì•¡ì„¸ìŠ¤
* ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤
* ì‚¬ì´íŠ¸ ê°„ ì—°ê²°ì„±
* ë§¤ìš° ë‚®ì€ ì§€ì—° ì‹œê°„ìœ¼ë¡œ DB ì—°ê²°ì´ ê°€ëŠ¥í•œì§€ í™•ì¸í•˜ì„¸ìš”.
* ë§ˆì´ê·¸ë ˆì´ì…˜ ìš”êµ¬ ì‚¬í•­(êµ¬ì„± ë§µ, ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤, ì œí•œ, ë¹„ë°€ ë“±)ì„ ì¶©ì¡±í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ì— ì½”ë“œ ìˆ˜ì •ì„ ì™„ë£Œí•©ë‹ˆë‹¤.
* ìˆ˜ì§‘ ë° ë³µì œ/ìƒì„±í•  í”„ë¡œì íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤
* í™˜ê²½ì—ì„œ ì ì ˆí•œ DNS í™•ì¸ì„ ë³´ì¥í•©ë‹ˆë‹¤.
* Microsoft ì°¸ì¡° ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì— ë”°ë¼ ëŒ€ìƒ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.
* ê³ ê°ì˜ ìŠ¹ì¸
* Azure Red Hat OpenShift 4 í´ëŸ¬ìŠ¤í„°ì— ëŒ€í•œ Microsoft Entra ì¸ì¦ êµ¬ì„±
* ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥, ë¶€í•˜ ë° ë¦¬ì†ŒìŠ¤ í™œìš©ë„ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.
* ìŠ¤ì¼€ì¼ë§ ìš”êµ¬ ì‚¬í•­ ê²°ì •
* Dockerë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
* ê° ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„± ìš”ì†Œì— ëŒ€í•œ Dockerfileì„ ë§Œë“­ë‹ˆë‹¤.
* ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê¸° ì „ì— ë°±ì—…ì´ ì œëŒ€ë¡œ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
* GitHub/Azure DevOpsì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ CI/CD íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•©ë‹ˆë‹¤.â€ƒ

== 5. ì‹¤í–‰

=== 5.1 OpenShift ì›¹ ì½˜ì†”, DockerFile ì „ëµ(ìˆ˜ë™), DockerHub ì´ë¯¸ì§€ ì‚¬ìš© AROì—ì„œ ì»¨í…Œì´ë„ˆí™” ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„

1. OpenShift í´ëŸ¬ìŠ¤í„°ì— ë¡œê·¸ì¸í•˜ê³  "Administration" í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ë‹¤.
2. ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì€ ê²½ìš° í”„ë¡œì íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë§Œë“­ë‹ˆë‹¤.
3. "Developer" ê´€ì ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤.
+
image:./images/image02.png[]
+
4. ë°°í¬ì—ëŠ” ì—¬ëŸ¬ê°€ì§€ ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤.
* GIT ë¦¬í¬ì§€í† ë¦¬ì—ì„œ
* ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬
5. ì—¬ê¸°ì„œëŠ” "container images" ì˜µì…˜ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.
6. â€œContainer imagesâ€ ì˜µì…˜ì„ í´ë¦­í•˜ë©´ ë‹¤ìŒ í˜ì´ì§€ê°€ ì—´ë¦½ë‹ˆë‹¤.
+
image:./images/image03.png[]
+
image:./images/image04.png[]
+
7. ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì´ë¯¸ì§€ ì´ë¦„(ê³µê°œ ë˜ëŠ” ë¹„ê³µê°œ)ì„ ì…ë ¥í•˜ê³  ëª¨ë“  ì„¸ë¶€ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ì´ë¯¸ì§€ê°€ ARO ì›Œí¬ë¡œë“œë¡œ ë°°í¬ë©ë‹ˆë‹¤. +
ì°¸ê³ : í¸ì˜ë¥¼ ìœ„í•´ DockerHub ê³µê°œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
8. ì›Œí¬ë¡œë“œê°€ ë°°í¬ë˜ë©´ ë°°í¬ ì„¸ë¶€ ì •ë³´, ë¡œê·¸ ë° ê¸°íƒ€ ëª¨ë‹ˆí„°ë§ ì¸¡ë©´ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
9. ë°°í¬ëœ ì‘ì—… ë¶€í•˜ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ë¥¼ ë³´ë ¤ë©´ "Administration" ì¸¡ë©´ìœ¼ë¡œ ì „í™˜í•˜ì„¸ìš”.
+
image:./images/image05.png[]
+
10. ê²½ë¡œ ì„¹ì…˜ì€ ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì™¸ë¶€ì ìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ”ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.
+
image:./images/image06.png[]
+
11. ë°°í¬ í›„ ìƒ˜í”Œ ì»¨í…Œì´ë„ˆì— ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
+
image:./images/image07.png[]
+
12. í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ë° ê¸°íƒ€ ê´€ë¦¬/ì¸í”„ë¼ ê´€ë ¨ ì‘ì—…ì„ ìœ„í•´ ê´€ë¦¬ì ëª¨ë“œë¡œ ì „í™˜í•˜ì„¸ìš”. "Workload" ë¸”ë ˆì´ë“œë¡œ ì´ë™í•˜ì—¬ Pod, ë°°í¬, ì‹œí¬ë¦¿, êµ¬ì„± ë§µë“±ì„ í™•ì¸í•˜ì„¸ìš”.
+
image:./images/image08.png[]
+
13. "pods" ë©”ë‰´ì—ì„œ ìƒˆë¡œìš´ í¬ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+
image:./images/image09.png[]
+
14. "Create pods"ë¥¼ í´ë¦­í•˜ë©´ ì•„ë˜ YAMLì´ í‘œì‹œë©ë‹ˆë‹¤. í…œí”Œë¦¿ì„ í¸ì§‘í•˜ê³  í¬ë“œë¥¼ ë§Œë“­ë‹ˆë‹¤.
+
image:./images/image10.png[]

=== 5.2 AROì—ì„œ ì»¨í…Œì´ë„ˆí™”ë¨ ì•±ì„ ìœ„í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„, OpenShift ì›¹ ì½˜ì†” ì‚¬ìš©, Docklerfile ì „ëµ(ìˆ˜ë™), Azure Container Registry(ACR) ì´ë¯¸ì§€ ì‚¬ìš©

Azure Container Registry(ACR)ëŠ” ì§€ë¦¬ì  ë³µì œì™€ ê°™ì€ ì—”í„°í”„ë¼ì´ì¦ˆ ê¸°ëŠ¥ì„ ê°–ì¶˜ í”„ë¼ì´ë¹— Docker ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê´€ë¦¬í˜• ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ARO í´ëŸ¬ìŠ¤í„°ì—ì„œ AROì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ í´ëŸ¬ìŠ¤í„°ê°€ Kubernetes ì‹œí¬ë¦¿ì— Docker ë¡œê·¸ì¸ ìê²© ì¦ëª…ì„ ì €ì¥í•˜ì—¬ ACRì— ì¸ì¦í•´ì•¼ í•©ë‹ˆë‹¤.

1. ì´ ê°€ì´ë“œì—ì„œëŠ” ê¸°ë³¸ Azure Container Registryê°€ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤. ì—†ëŠ” ê²½ìš° Azure Portal ë˜ëŠ” Azure CLI ì§€ì¹¨ì„ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ë§Œë“œì„¸ìš”. ìì„¸í•œ ë‚´ìš©ì€ Azure Landing Zone Accelerlatorë¥¼ ì°¸ì¡°í•˜ì„¸ìš”. +
ìì„¸í•œ ë‚´ìš©ì€ https://github.com/Azure/ARO-Landing-Zone-Accelerator/blob/main/deployment/CLI/09%20appdeployment/app.azcli[ARO-Landing-Zone-Accelerator GitHub í˜ì´ì§€]ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
+
2. OpenShift í´ëŸ¬ìŠ¤í„° "Administration" í¼ìŠ¤í™í‹°ë¸Œì— ë¡œê·¸ì¸í•˜ê³  ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´í›„ ë‹¨ê³„ì—ì„œëŠ” ìƒˆë¡œ ìƒì„±ëœ í”„ë¡œì íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
+
image:./images/image11.png[]
+
3. ëª¨ë“  ë³´ì•ˆ ê¶Œí•œ(Full secret)ì„ ì–»ìŠµë‹ˆë‹¤.
* ARO í´ëŸ¬ìŠ¤í„°ì—ì„œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì•¡ì„¸ìŠ¤ í•˜ë ¤ë©´ ACRì—ì„œ ëª¨ë“  ë³´ì•ˆ ê¶Œí•œ(Full secret)ì´ í•„ìš”í•©ë‹ˆë‹¤.
* ëª¨ë“  ë³´ì•ˆ ê¶Œí•œ(Full secret)ì„ ì–»ìœ¼ë ¤ë©´ Azure Portalì´ë‚˜ Azure CLIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* Azure Portalì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ACR ì¸ìŠ¤í„´ìŠ¤ë¡œ ì´ë™í•˜ì—¬ ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. docker-usernameì€ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì˜ ì´ë¦„ì´ë©°, docker-passwordì—ëŠ” Password ë˜ëŠ” password2ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
+
image:./images/image12.png[]
+
* ëŒ€ì‹  Azure CLIë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ìê²© ì¦ëª…ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+
----
az acr credential show -n your registry name
----
+
4. ì¿ ë²„ë„¤í‹°ìŠ¤ Secret ìƒì„±: ì´ ìê²©ì¦ëª…ì„ ì‚¬ìš©í•˜ì—¬ ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹œí¬ë¦¿ì„ ìƒì„±í•©ë‹ˆë‹¤. ACR ìê²© ì¦ëª…ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
+
----
oc create secret docker-registry \
--docker-server=<your registry name>.azurecr.io \
--docker-username=<your registry name> \
--docker-password=******** \
--docker-email=unused \
 acr-secret
----
+
5. ì„œë¹„ìŠ¤ ê³„ì •ì— ì‹œí¬ë¦¿ì„ ì—°ê²°í•©ë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ, Podê°€ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ í¬ë“œì—ì„œ ì‚¬ìš©í•  ì„œë¹„ìŠ¤ ê³„ì •ì— ì‹œí¬ë¦¿ì„ ì—°ê²°í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ê³„ì • ì´ë¦„ì€ Podì—ì„œ ì‚¬ìš©í•˜ëŠ” ì„œë¹„ìŠ¤ ê³„ì • ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. defaultëŠ” ê¸°ë³¸ ì„œë¹„ìŠ¤ ê³„ì •ì…ë‹ˆë‹¤.
+
----
oc secrets link default <pull_secret_name> --for=pull
----
+
6. oc new-app ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ACR ì´ë¯¸ì§€ë¥¼ ë°°í¬í•˜ê³  ì´ë¯¸ì§€ í’€ ì‹œí¬ë¦¿ì„ ì—°ê²°í•©ë‹ˆë‹¤.
+
----
oc new-app --name=sample-aro-dotnet-app-using-acr <your_ registry_name>.azurecr.io/aro-dotnet-sample-app:latest
----
+
7. í˜„ì¬ ì„œë¹„ìŠ¤ëŠ” ì¤€ë¹„ë˜ì—ˆì§€ë§Œ, ê³µìš© ì¸í„°ë„·ì„ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ì†í•  ê²½ë¡œëŠ” ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ê²°ë¡œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
+
----
oc expose svc/aro-dotnet-sample-app
----
+
8. ë…¸ì¶œëœ ê²½ë¡œë¡œ ì´ë™í•˜ì—¬ ì•±ì— ì ‘ì†í•©ë‹ˆë‹¤.
+
image:./images/image13.png[]
+
image:./images/image14.png[]

=== 5.3 OpenShift ì›¹ ì½˜ì†”ì„ ì‚¬ìš©í•œ ARO ì»¨í…Œì´ë„ˆí™” ì•± ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„, S2I(Source-to-Image) ì „ëµ(ìˆ˜ë™)

1. ì´ ì ‘ê·¼ ë°©ì‹ì€ DockerFileì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„, ì¦‰ ì•±ì„ ì»¨í…Œì´ë„ˆí™” í•˜ì§€ ì•Šê³ ë„ ì‘ë™í•©ë‹ˆë‹¤. ì´ ì „ëµì€ ì†ŒìŠ¤ë¥¼ ì´í•´í•˜ê³  ëŒ€ìƒ ì–¸ì–´ì™€ ìš´ì˜ì²´ì œë¥¼ ì´í•´í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë§Œë“œëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.
+
image:./images/image15.png[]
+
2. ê°€ì ¸ì˜¤ê¸° ì „ëµì„ â€œBuilder imageâ€ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
+
image:./images/image16.png[]
+
image:./images/image17.png[]
+
3. ì›Œí¬ë¡œë“œë¥¼ ìƒì„±í•˜ë©´ ë™ì¼í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë˜ì§€ë§Œ S2I ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
+
image:./images/image18.png[]
+
4. Workloadë¥¼ í´ë¦­í•˜ê³  ìƒì„±ëœ ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ íƒìƒ‰í•©ë‹ˆë‹¤.
+
image:./images/image19.png[]
+
5. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë˜ë©´ ë…¸ì¶œëœ ì„œë¹„ìŠ¤ ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+
image:./images/image20.png[]

=== 5.4 OpenShift(OC) ëª…ë ¹ì¤„ì„ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™” ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„

1. ìƒˆ í´ëŸ¬ìŠ¤í„°ê°€ ì„¤ì¹˜ë˜ë©´ "Help" ì•„ì´ì½˜ìœ¼ë¡œ ì´ë™í•˜ê³  "Command line Tools" ì˜µì…˜ìœ¼ë¡œ ì´ë™í•˜ë©´ OpenShift ëª…ë ¹ì¤„ ë„êµ¬ë¥¼ ë‹¤ìš´ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+
image:./images/image21.png[]
+
2. oc ëª…ë ¹ì¤„ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì›¹ ì½˜ì†” ë‹¨ê³„ì— ì •ì˜ëœ ëª¨ë“  ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+
https://docs.openshift.com/en/container-platform/4.8/cli_reference/openshift_cli/developer-cli-commands.html[OpenShift CLI ê°œë°œì ëª…ë ¹ ì°¸ì¡° - OpenShift CLI(oc) | CLI ë„êµ¬ | OpenShift Container Platform 4.8]
3. oc ëª…ë ¹ì¤„ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ OpenShift í´ëŸ¬ìŠ¤í„°ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ëŠ” ë‹¨ê³„ë§Œ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤.
4. í´ëŸ¬ìŠ¤í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ oc ëª…ë ¹ì¤„ ë„êµ¬ì— ì—°ê²°í•˜ë ¤ë©´ "copy login command"ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ íƒ­ì´ ì—´ë¦¬ê³  í† í°ì´ í‘œì‹œë©ë‹ˆë‹¤.
+
image:./images/image22.png[]
+
5. í˜¸ê·¸ì¸ ëª…ë ¹ì„ ë³µì‚¬í•˜ê³  ì›í•˜ëŠ” ëª…ë ¹ í”„ë¡¬í”„íŠ¸/í„°ë¯¸ë„/PowerShellì„ ì‚¬ìš©í•˜ì—¬ í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°í•©ë‹ˆë‹¤.
6. oc new-app ëª…ë ¹ì„ ì‚¬ìš©í•˜ë©´ ì›Œí¬ë¡œë“œë¥¼ í´ëŸ¬ìŠ¤í„°ì— ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+
----
oc new-app openshift/dotnet:8.0~https://github.com/<user_name>/aro-sample-project.git --name=aro-sample-app-cmd --context-dir=aro-sample-project
----
+
image:./images/image23.png[]
+
image:./images/image24.png[]
7. ìœ„ ëª…ë ¹ì–´ëŠ” ìƒ˜í”Œì•±ê³¼ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•©ë‹ˆë‹¤. ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+
----
oc new-app openshift/dotnet:8.0~https://github.com/<user_name>/aro-sample-project.git --name=aro-sample-app-cmd --context-dir=aro-sample-project
----
+
image:./images/image25.png[]
8. í˜„ì¬ ì„œë¹„ìŠ¤ëŠ” ì¤€ë¹„ë˜ì—ˆì§€ë§Œ, ê³µìš© ì¸í„°ë„·ì„ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ì†í•  ê²½ë¡œê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ê²½ë¡œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
+
----
oc expose svc/aro-sample-app-cmd
----
+
image:./images/image26.png[]
9. ê²½ë¡œê°€ í™œì„±í™”ë˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
+
image:./images/image27.png[]
+
image:./images/image20.png[]

== 6. DevOps íŒŒì´í”„ë¼ì¸

=== 6.1 OpenShift ë‚´ì¥ Tekton íŒŒì´í”„ë¼ì¸ì„ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™”ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„(ìˆ˜ë™ íŠ¸ë¦¬ê±°)

1. OpehShiftì—ì„œ Tektonì€ OpenShift Pipeline Operatorë¼ëŠ” ìš´ì˜ìë¡œ ì œê³µë©ë‹ˆë‹¤. ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. `Administrator` ë·°ë¥¼ ì„ íƒí•œ í›„ `Operators` -> `Installed Operators` -> `Searchf or OpenShift Pipelines` ë¡œ ì´ë™í•˜ì—¬ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
+
image:./images/image28.png[]
2. ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ê³  ì´ë¦„ì„ 'cmf-sample-pipeline-dotnet-app'ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
+
image:./images/image29.png[]
3. Tektonì€ ëª¨ë“  íŒŒì´í”„ë¼ì¸ í˜¸ì¶œ ì‹œ Persistent volumeì„ ìš”êµ¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ í”„ë¡œì íŠ¸ì— ìµœì†Œ 1GBì˜ ì˜êµ¬ ë³¼ë¥¨ í´ë ˆì„(PVC)ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ë§Œì•½ ì—†ë‹¤ë©´ `administrator` ë·°ë¥¼ ì„ íƒí•œ í›„ `Storage` ->  `Persistent Volume Claim` ìœ¼ë¡œ ì´ë™í•˜ì—¬ PVCë¥¼ ìƒì„±í•˜ê³  `my-sample-app-tekton-pvc` ë¼ëŠ” ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
+
image:./images/image30.png[]
+
image:./images/image31.png[]
4. íŒŒì´í”„ë¼ì¸ì„ ìƒì„±í•˜ë ¤ë©´ `Administrator` ë³´ê¸°ë¥¼ ì„ íƒí•˜ê³  `Pipelines` -> `Pipelines` ë¡œ ì´ë™í•œ ë‹¤ìŒ ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ `Choose` ë¥¼ í´ë¦­í•˜ê³  `Pipeline` ì„ ì„ íƒí•©ë‹ˆë‹¤.
* Pipeline Builder ì–‘ì‹ì´ ì—´ë¦¬ë©´ ì•„ë˜ì˜¤ ã…ê°™ì´ êµ¬ì„±í•©ë‹ˆë‹¤.
** `Configure via` ì—ì„œ `Pipeline Builder` ë¼ë””ì˜¤ ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
** `name` í•„ë“œì— íŒŒì´í”„ë¼ì¸ ì´ë¦„(ì˜ˆ: `aro-dotnet-builder-pipeline`)ì„ ì…ë ¥í•©ë‹ˆë‹¤.
** Parametersì—ì„œ, `Add Parameter`ë¥¼ í´ë¦­í•˜ì—¬ 4ê°œì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
*** Name: APP_NAME, ì„¤ëª…: ë°°í¬í•  ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì´ë¦„, ê¸°ë³¸ê°’: my-sample-dotnet-app
*** Name: APP_GIT_REPO, ì„¤ëª…: ì• í”Œë¦¬ì¼€ì´ì…˜ ì†ŒìŠ¤ ì½”ë“œì— ëŒ€í•œ GitHub repo URL, ê¸°ë³¸ê°’: https://github.com/ <your_GitHub_user>/<your_repo_name>
*** Name: GIT_REVISION, ì„¤ëª…: ë°°í¬í•  GitHub repo ë¸Œëœì¹˜ ì´ë¦„, ê¸°ë³¸ê°’: master(ë˜ëŠ” main)
*** Name: PROJECT_NAME, ì„¤ëª…: ì´ë¯¸ì§€ ìŠ¤íŠ¸ë¦¼ì´ ë‚´ë¶€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì €ì¥ë˜ëŠ” OpenShift í”„ë¡œì íŠ¸, ê¸°ë³¸ê°’: <Your_current_Namespace>
* workspaceì—ì„œ, `add workspace`ë¥¼ í´ë¦­í•˜ì—¬ ìƒˆ workspaceë¥¼ ìƒì„±í•˜ê³ , `share-workspace`ë¥¼ ì…ë ¥í•˜ê³  ìƒˆ ì‘ì—… ê³µê°„ì„ ìƒì„±í•©ë‹ˆë‹¤.
+
image:./images/image32.png[]
+
image:./images/image33.png[]
5. Tekton íŒŒì´í”„ë¼ì¸ì˜ ê¸°ë³¸ ì •ì˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë³µì œ-ë¹Œë“œ-ë°°í¬ ì£¼ê¸°ë¥¼ ìœ„í•œ íŒŒì´í”„ë¼ì¸ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
6. Pipeline ì‘ì—… - ì•„ë˜ëŠ” ëª¨ë“  ìƒ˜í”Œ íŒŒì´í”„ë¼ì¸ì— ëŒ€í•œ ìƒ˜í”Œ ì‘ì—…ì…ë‹ˆë‹¤.
+
**Task 1: Githubì—ì„œ ì†ŒìŠ¤ ì½”ë“œ ê²€ìƒ‰**
+
Pipeline Builderì—ì„œ `Add Task` ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. `git clone` ì„ ì…ë ¥í•˜ê³  Red Hatì—ì„œ ì‘ì—…ì„ ì„ íƒí•œ í›„ `Add` ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
+
image:./images/image34.png[]
+
ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±í•©ë‹ˆë‹¤.
+
----
* Display Name: fetch
* Parameters->url : $(params.APP_GIT_REPO)
* Parameter->revision : $(params.GIT_REVISION)
* Workspaces->output : shared-workspace
----
+
ë‹¤ë¥¸ ê°’ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤. ì´ ì‘ì—…ì˜ êµ¬ì„±ì„ ì¢…ë£Œí•˜ë ¤ë©´ ë°”ê¹¥ìª½ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­í•©ë‹ˆë‹¤.
+
image:./images/image35.png[]
+
**Task 2: ì†ŒìŠ¤ ì½”ë“œ ë¹Œë“œ**
+
`fetch` ì‘ì—…ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ê³  ì˜¤ë¥¸ìª½ì— ìˆëŠ” íŒŒë€ìƒ‰ `+` ê¸°í˜¸ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë‹¤ë¥¸ ì‘ì—…ì´ ì¶”ê°€ë©ë‹ˆë‹¤. ìƒˆë¡œìš´ `Add Task` ë²„íŠ¼ì„ í´ë¦­í•˜ê³  í•„í„°ì— `S2I dotnet` ì„ ì…ë ¥í•©ë‹ˆë‹¤. Red Hatì—ì„œ í•´ë‹¹ ì˜µì…˜ì„ ì„ íƒí•˜ê³  `Add` ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ì‘ì—…ì„ ë‹¤ì‹œ í´ë¦­í•˜ì—¬ ì‘ì—… êµ¬ì„±ì„ ì—´ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
+
----
* Display name: build
* Parameters-> Image :

  image-registry openshift-image-registry.svc:5000/$(params.PROJECT_NAME)/$(params.APP_NAME):dev

* Add environment variable - DOTNET_STARTUP_PROJECT=aro-sample-project/aro-sample-project.csproj
* Workspaces->source : shared-workspace
----
+
ë‹¤ë¥¸ ê°’ì€ ê¸°ë³¸ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤. ì´ ì‘ì—…ì˜ êµ¬ì„±ì„ ì¢…ë£Œí•˜ë ¤ë©´ ë°”ê¹¥ìª½ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­í•©ë‹ˆë‹¤.
+
image:./images/image36.png[]
+
image:./images/image37.png[]
+
**Task 3: ê¸°ì¡´ ë°°í¬ ì œê±°**
+
`build` ì‘ì—…ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ê³  ì˜¤ë¥¸ìª½ì— ìˆëŠ” íŒŒë€ìƒ‰ `+` ê¸°í˜¸ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë‹¤ë¥¸ ì‘ì—…ì´ ì¶”ê°€ë©ë‹ˆë‹¤. ìƒˆë¡œìš´ `Add Task` ë²„íŠ¼ì„ í´ë¦­í•˜ê³  í•„í„°ì— `OpenShift Client` ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. Red Hatì—ì„œ ì˜µì…˜ì„ ì„ íƒí•˜ê³  `Add` ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. `Task` ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ì—¬ ì‘ì—… êµ¬ì„±ì„ ì—´ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
+
----
* Display Name: cleanup-old-deployment
* Parameters->Script :

  oc delete all -l app=$(params.APP_NAME)
----
+
image:./images/image38.png[]
+
ë‹¤ë¥¸ ê°’ì€ ê¸°ë³¸ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤. ì´ ì‘ì—…ì˜ êµ¬ì„±ì„ ì¢…ë£Œí•˜ë ¤ë©´ ë°”ê¹¥ìª½ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­í•©ë‹ˆë‹¤.
+
**Task 4: ë¹Œë“œëœ ì½”ë“œ ë°°í¬**
+
`cleanup-old-deployment` ì‘ì—…ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ê³  ì˜¤ë¥¸ìª½ì— ìˆëŠ” íŒŒë€ìƒ‰ `+` ê¸°í˜¸ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë‹¤ë¥¸ ì‘ì—…ì— ì¶”ê°€ë©ë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±ëœ 'Add Task' ë²„íŠ¼ì„ í´ë¦­í•˜ê³  í•„í„°ì— `OpenShift Client` ë¥¼ ì…ë ¥í•˜ì„¸ìš”. Red Hatì—ì„œ í•´ë‹¹ ì˜µì…˜ì„ ì„ íƒí•˜ê³  `Add` ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤. `Task` ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ì—¬ ì‘ì—… êµ¬ì„±ì„ ì—´ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•˜ì„¸ìš”.
+
----
* Display Name: deploy-code
* Parameters->SCRIPT

  oc new-app --name $(params.APP_NAME) --as-deployment-config image-registry.openshift-image-registry.svc:5000/$(params.PROJECT_NAME)/$(params.APP_NAME):dev --context-dir=aro-sample-project

----
+
ë‹¤ë¥¸ ê°’ì€ ê¸°ë³¸ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤. ì´ ì‘ì—…ì˜ êµ¬ì„±ì„ ì¢…ë£Œí•˜ë ¤ë©´ ë°”ê¹¥ìª½ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­í•©ë‹ˆë‹¤.
+
image:./images/image39.png[]
+
**Task 5: ê²½ë¡œìƒì˜ ì„œë¹„ìŠ¤ ë…¸ì¶œ**
+
`deploy` ì‘ì—…ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ê³  ì˜¤ë¥¸ìª½ì— ìˆëŠ” íŒŒë€ìƒ‰ `+` ê¸°í˜¸ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë‹¤ë¥¸ ì‘ì—…ì´ ì¶”ê°€ë©ë‹ˆë‹¤. ìƒˆë¡œìš´ `Add Task` ë²„íŠ¼ì„ í´ë¦­í•˜ê³  í•„í„°ì— `OpenShift Client` ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. Red Hatì—ì„œ ì˜µì…˜ì„ ì„ íƒí•˜ê³  `Add` ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ì‘ì—…ì„ ë‹¤ì‹œ í´ë¦­í•˜ì—¬ ì‘ì—… êµ¬ì„±ì„ ì—´ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
+
----
* Display Name: expose-service
* Parameters->SCRIPT:

  oc expose svc $(params.APP_NAME)
----
+
ë‹¤ë¥¸ ê°’ì€ ê¸°ë³¸ ê°’ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤. ì´ ì‘ì—…ì˜ êµ¬ì„±ì„ ì¢…ë£Œí•˜ë ¤ë©´ ë°”ê¹¥ìª½ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­í•©ë‹ˆë‹¤.
+
image:./images/image40.png[]
+
image:./images/image41.png[]
+
**Task 6: ë°°í¬ í™•ì¸**
+
`expose-service` ì‘ì—…ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ê³  ì˜¤ë¥¸ìª½ì— ìˆëŠ” íŒŒë€ìƒ‰ `+` ê¸°í˜¸ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë‹¤ë¥¸ ì‘ì—…ì´ ì¶”ê°€ë©ë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±ëœ `Add Task` ë²„íŠ¼ì„ í´ë¦­í•˜ê³  í•„í„°ì— `OpenShift Client` ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. Red Hatì—ì„œ í•´ë‹¹ ì˜µì…˜ì„ ì„ íƒí•˜ê³  `Add` ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ì‘ì—…ì„ ë‹¤ì‹œ í´ë¦­í•˜ì—¬ ì‘ì—… êµ¬ì„±ì„ ì—´ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
+
----
* Display Name: verify-rollout
* Parameters->SCRIPT :

  oc rollout status dc/$(params.APP_NAME)
----
+
ë‹¤ë¥¸ ê°’ì€ ê¸°ë³¸ ê°’ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤. ì´ ì‘ì—…ì˜ êµ¬ì„±ì„ ì¢…ë£Œí•˜ë ¤ë©´ ë°”ê¹¥ìª½ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­í•©ë‹ˆë‹¤. íŒŒì´í”„ë¼ì¸ì„ ìƒì„±í•˜ë ¤ë©´ íŒŒë€ìƒ‰ 'Create' ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
+
image:./images/image42.png[]
+
GitHub ì €ì¥ì†Œì— ë³€ê²½ ì‚¬í•­ì„ ì»¤ë°‹í•˜ê³  íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•˜ì—¬ ë³€ê²½ ì‚¬í•­ì„ í™•ì¸í•©ë‹ˆë‹¤.
+
image:./images/image43.png[]

7. íŒŒì´í”„ë¼ì¸ì„ ìˆ˜ë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.
8. `Administration` ë³´ê¸°ë¡œ ì´ë™í•˜ì—¬ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì  ì„¸ê°œë¡œ í‘œì‹œëœ ë²„ê±° ë©”ë‰´ë¥¼ ì„ íƒí•˜ê³  `Start` ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
+
image:./images/image44.png[]
+
9. íŒŒë¼ë¯¸í„°ë¥¼ ê²€í† í•˜ê³  íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•  PVC(Persistent Volume Claim)ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. `Start` ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
+
image:./images/image45.png[]
+
10. workload, Pod, Service ë° routesë¥¼ ê²€í† í•©ë‹ˆë‹¤. route pathë¥¼ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì•¡ì„¸ìŠ¤í•©ë‹ˆë‹¤.
+
image:./images/image46.png[]
+
image:./images/image47.png[]

=== 6.2 OpenShift ë‚´ì¥ Tekton íŒŒì´í”„ë¼ì¸ì„ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™”ëœ ì•±ì„ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ëŠ” ë‹¨ê³„(ìë™ íŠ¸ë¦¬ê±°, GitHub ì›¹í›…)

1. íŒŒì´í”„ë¼ì¸ê³¼ ê²°í•©ëœ íŠ¸ë¦¬ê±°ë¥¼ ì‚¬ìš©í•˜ë©´ íŒŒì´í”„ë¼ì¸ì„ ì—°ê²°í•˜ì—¬ ì™¸ë¶€ GitHub ì´ë²¤íŠ¸(í‘¸ì‹œ ì´ë²¤íŠ¸, í’€ ë¦¬í€˜ìŠ¤íŠ¸ ë“±)ì— ì‘ë‹µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. ì´ë¥¼ ìœ„í•œ ì „ì œ ì¡°ê±´ì€ ì›¹í›…ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í”„ë¡œì íŠ¸ì— Trigger Template, TriggerBinding, EventListenerë¥¼ ì •ì˜í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
3. ì›¹í›…ê³¼ ì—°ê²°ë  GitHub-secretì„ ìƒì„±í•©ë‹ˆë‹¤. `webhook-secret.yaml` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
+
----
webhook-secret.yml:
-------------------

apiVersion: v1
kind: Secret
metadata:
name: webhook-secret
namespace: cmf-pipeline-project
stringData:
secretToken: sample-secret
----
+ 
4. Secretì„ ì ìš©í•©ë‹ˆë‹¤.
+
----
oc apply -f webhook-secret.yaml
----
5. ì´ì œ TriggerTemplteì„ ì •ì˜í•©ë‹ˆë‹¤. TriggerTemplateì€ í…œí”Œë¦¿ ë¦¬ì†ŒìŠ¤ ë‚´ ì–´ë””ì—ì„œë‚˜ ëŒ€ì²´ë  ìˆ˜ ìˆëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì§„ ë¦¬ì†ŒìŠ¤ì…ë‹ˆë‹¤. `github-template.yaml` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
+
----
github-template.yml:
--------------------

apiVersion: triggers.tekton.dev/v1alpha1
kind: TriggerTemplate
metadata:
name: github-template
spec:
params:
    - name: gitrevision
    description: The git revision
    default: main
    - name: gitrepositoryurl
    description: The git repository URL
resourcetemplates:
    - apiVersion: tekton.dev/v1beta1
    kind: PipelineRun
    metadata:
        generateName: github-pipelinerun-
    spec:
        pipelineRef:
        name: aro-dotnet-builder-pipeline
        workspaces:
        - name: shared-workspace
            persistentVolumeClaim:
            claimName: my-sample-app-tekton-pvc
        params:
        - name: gitrevision
            value: $(params.gitrevision)
        - name: gitrepositoryurl
            value: $(params.gitrepositoryurl)
----
+
6. í…œí”Œë«ì„ ì ìš©í•©ë‹ˆë‹¤.
+
----
oc apply -f github-template.yaml
----
+
7. ë‹¤ìŒ ë‹¨ê³„ëŠ” ì´ë²¤íŠ¸ì—ì„œ í•„ë“œë¥¼ ìº¡ì²˜í•˜ê³  íŒŒë¼ë¯¸íŠ¸ë¡œ ì €ì¥í•œ ë‹¤ìŒ ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ ë§ˆë‹¤ TriggerTemplateì—ì„œ ì´ë¥¼ ë°”ê¿€ìˆ˜ ìˆëŠ” TriggerBindingì„ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤. +
`github-binding.yaml` íŒŒì¼ì„ ë§Œë“¤ê³  ë™ì¼í•˜ê²Œ ì ìš©í•©ë‹ˆë‹¤.
+
----
github-binding.yaml:
-------------------

apiVersion: triggers.tekton.dev/v1alpha1
kind: TriggerBinding
metadata:
name: github-binding
spec:
params:
    - name: gitrevision
    value: $(body.head_commit.id)
    - name: gitrepositoryurl
    value: $(body.repository.clone_url)
----
+
----
oc apply -f github-binding.yaml        
----
+
8. ë§ˆì§€ë§‰ìœ¼ë¡œ EventListenerë¥¼ ë§Œë“­ë‹ˆë‹¤. ì´ ì»´í¬ë„ŒíŠ¸ëŠ” Serviceë¥¼ ì„¤ì •í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤. ë˜í•œ TriggerTemplateì„ TriggerBindingì— ì—°ê²°í•˜ì—¬ ì£¼ì†Œ ì§€ì • ê°€ëŠ¥í•œ ì—”ë“œí¬ì¸íŠ¸(ì´ë²¤íŠ¸ ì‹±í¬)ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
+
`github-listener.yaml` íŒŒì¼ì„ ë§Œë“¤ê³  ë™ì¼í•˜ê²Œ ì ìš©í•©ë‹ˆë‹¤.
+
----
github-listener.yaml:
--------------------

apiVersion: triggers.tekton.dev/v1alpha1
kind: EventListener
metadata:
name: github-listener
spec:
serviceAccountName: pipeline
triggers:
    - name: github-trigger
    interceptors:
        - ref:
            name: "github"
        params:
            - name: secretRef
            value:
                secretKey: secretToken
                secretName: webhook-secret
    bindings:
        - ref: github-binding
    template:
        ref: github-template
----
+
----
oc apply -f github-listener.yaml
----
+
9. ì•„ë˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ eventListener ì„œë¹„ìŠ¤ë¥¼ ê²½ë¡œë¡œ ë…¸ì¶œí•©ë‹ˆë‹¤.
+
----
oc expose svc el-github-listener
----
+
10. ë‹¤ìŒ ë‹¨ê³„ëŠ” GitHub ì €ì¥ì†Œì—ì„œ ì›¹í›…ì„ êµ¬ì„±í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
* GitHub ì €ì¥ì†Œì—ì„œ:
** `Settings` -> 'WebHooks' ë¡œ ì´ë™í•©ë‹ˆë‹¤.
** `Add webhook` ì„ í´ë¦­í•©ë‹ˆë‹¤.
** `oc expose` ëª…ë ¹ìœ¼ë¡œ ìƒì„±ëœ ê²½ë¡œ URLë¡œ í˜ì´ë¡œë“œ URLì„ ì„¤ì •í•©ë‹ˆë‹¤.
** `Content type` ì„ `application/Json` ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
** `Secret` ì•„ë˜ì— ë¹„ë°€ í† í°ì„ ì¶”ê°€í•©ë‹ˆë‹¤. (webhook-secret.yamlì—ì„œ ì‚¬ìš©í•œ í† í°ê³¼ ë™ì¼)
** webhookì„ íŠ¸ë¦¬ê±°í•´ì•¼ í•˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. (ì˜ˆ: í‘¸ì‹œ ì´ë²¤íŠ¸)
** `Add webhook` ì„ í´ë¦­í•©ë‹ˆë‹¤.
+
image:./images/image48.png[]
+
11. ì„¤ì •ì„ í…ŒìŠ¤íŠ¸í•˜ê³  Github ì €ì¥ì†Œì— ë³€ê²½ ì‚¬í•­ì„ í‘¸ì‹œí•˜ë©´ ëª¨ë“  í‘¸ì‹œ ì´ë²¤íŠ¸ì— ëŒ€í•´ íŒŒì´í”„ë¼ì¸ì´ ìë™ìœ¼ë¡œ ì‹œì‘ë©ë‹ˆë‹¤.
+
image:./images/image49.png[]

=== 6.3 GibHub Actionsë¥¼ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™” ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„

GitHub ActionsëŠ” ëª¨ë“  GitHub ì €ì¥ì†Œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™í™” ì‘ì—…ì…ë‹ˆë‹¤. ì´ë²¤íŠ¸ëŠ” ì‘ì—…ì„ í¬í•¨í•˜ëŠ” ì›Œí¬í”Œë¡œë¥¼ ìë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ì‘ì—…ì€ ë‹¨ê³„ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì—… ì‹¤í–‰ ìˆœì„œë¥¼ ì œì–´í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì‘ì—…ì€ ì†Œí”„íŠ¸ì›¨ì–´ ë¹Œë“œ, í…ŒìŠ¤íŠ¸ ë° ë°°í¬ë¥¼ ìë™í™”í•˜ëŠ” ëª…ë ¹ì…ë‹ˆë‹¤. ì´ ì¥ì—ì„œëŠ” ìƒ˜í”Œ .NET Core ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  docker-hub ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— í‘¸ì‹œí•˜ê¸° ìœ„í•œ GitHub Actionì„ ì¶”ê°€í•©ë‹ˆë‹¤. +
ì°¸ê³ : GitHub Azure ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë“± ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

==== 1) OpenShift í”„ë¡œì íŠ¸ ìƒì„±

`Administrator` ê´€ì ìœ¼ë¡œ ì´ë™í•˜ì—¬ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.

image:./images/image50.png[]

==== 2) GitHub Action êµ¬ì„±

GitHub Actions ì›Œí¬í”Œë¡œëŠ” í™˜ê²½ìœ¼ë¡œ ì‹¤í–‰ë˜ë©°, í•´ë‹¹ í™˜ê²½ì˜ ë³´í˜¸ ê·œì¹™ê³¼ ë¹„ë°€ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í™˜ê²½ì„ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë‹¨ê³„ì—ì„œëŠ” developmentë¼ëŠ” ì´ë¦„ì˜ ìƒˆ í™˜ê²½ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ì „ì— GibHubì—ì„œ í¬í¬í•œ `aro-sample-project` ì €ì¥ì†Œì—ì„œ ì˜¤ë¥¸ìª½ ìƒë‹¨ ë©”ë‰´ë¡œ ì´ë™í•˜ì—¬ ì„¤ì •ì„ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ì™¼ìª½ ë©”ë‰´ì—ì„œ `Environment` ë¥¼ í´ë¦­í•˜ê³  ì˜¤ë¥¸ìª½ì—ì„œ `new environment` ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

image:./images/image51.png[]

==== 3) GitHub í™˜ê²½ ì„¤ì •

ë‹¤ìŒ ì°½ì—ì„œ ì´ë¦„ì— ì‚¬ìš©í•  GitHub í™˜ê²½ì˜ ì´ë¦„ì„ ì‚½ì…í•©ë‹ˆë‹¤.

Action: **development**

`Configure environment` ë¥¼ í´ë¦­í•˜ì—¬ í™˜ê²½ êµ¬ì„±ì„ ìƒì„±í•©ë‹ˆë‹¤.

image:./images/image52.png[]

==== 4) Github Secret

ë°©ê¸ˆ ìƒì„±í•œ GitHub í™˜ê²½ developmentì˜ ê²°ê³¼ í™”ë©´ì—ì„œ ìƒˆë¡œ ìƒì„±ëœ í™˜ê²½ì˜ ëª¨ë“  ì„¸ë¶€ ì •ë³¼ë¥´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„¹ì…˜ í•˜ë‹¨ì˜ `Environment Secret` ë¡œ ì´ë™í•˜ê³  'Add Secret' ë¥¼ í´ë¦­í•˜ì—¬ ìƒˆ Secretì„ ì¶”ê°€í•©ë‹ˆë‹¤.

ì´ì œ GitHub Actionì—ì„œ OpenShift í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°í•˜ëŠ”ë° ì‚¬ìš©í•  ë‘ ê°œì˜ Secretì„ êµ¬ì„±í•©ë‹ˆë‹¤.

* OPENSHIFT_SERVER: The OpenShift API server
* OPENSHIFT_TOKEN: The authentication token to connect with
* IMAGE_REGISTRY_PASSWORD: Docker hub token

image:./images/image53.png[]

==== 5) Action ì¶”ê°€

ì´ì œ GitHub Actionê³¼ OpenShiftë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™í™”ë¥¼ ì‹œì‘í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. GitHub Actionì˜ ì›Œí¬í”Œë¡œì™€ ì‘ì—…ì€ í•„ìš”í•œ ëª¨ë“  ë‹¨ê³„ê°€ í¬í•¨ëœ YAML íŒŒì¼ë¡œ ì •ì˜ë©ë‹ˆë‹¤.

1. GitHubì—ì„œ `sample-dotnet-application` ë°±ì—”ë“œ ë¹Œë“œë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” ë‹¤ìŒ ì›Œí¬í”Œë¡œë¥¼ ê²€í† í•©ë‹ˆë‹¤.
2. GitHubì—ì„œ OpenShift ìŠ¤íƒ€í„° í…œí”Œë¦¿ì„ ì„ íƒí•˜ê³  ì›Œí¬í”Œë¡œë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•œ ë‹¨ê³„ì™€ ë³€ìˆ˜ë¥¼ í¸ì§‘í•©ë‹ˆë‹¤.
+
image:./images/image54.png[]
+
ë˜ëŠ”, 
+
image:./images/image55.png[]
+
3. main.yml ì˜ˆì œ ìƒˆ íŒŒì¼ì˜ ì´ë¦„ì„ openshift.ymlë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
4. ì´ì „ì— ë³µì‚¬í•œ YAML ë‚´ìš©ì„ ìƒˆ íŒŒì¼ í¸ì§‘ ì•„ë˜ì˜ ì½”ë“œ í…ìŠ¤íŠ¸ ìƒìì— ë¶™ì—¬ë„£ì–´ ì˜ˆì œ ë‚´ìš©ì„ ë°”ê¿‰ë‹ˆë‹¤.
5. `Start Commit` ì„ í´ë¦­í•©ë‹ˆë‹¤. Commnt ì œëª©ì„ ì…ë ¥í•˜ê³  `new file commit` ì„ í´ë¦­í•©ë‹ˆë‹¤.
6. ì°¸ê³ ìš©ìœ¼ë¡œ ì‹œì‘ í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ì„¸ìš”.
+
----
name: OpenShift

env:
# ğŸ–Šï¸ EDIT your repository secrets to log into your OpenShift cluster and set up the context.
# See https://github.com/redhat-actions/oc-login#readme for how to retrieve these values.
# To get a permanent token, refer to https://github.com/redhat-actions/oc-login/wiki/Using-a-Service-Account-for-GitHub-Actions
OPENSHIFT_SERVER: ${{ secrets.OPENSHIFT_SERVER }}
OPENSHIFT_TOKEN: ${{ secrets.OPENSHIFT_TOKEN }}
# ğŸ–Šï¸ EDIT to set the kube context's namespace after login. Leave blank to use your user's default namespace.
OPENSHIFT_NAMESPACE: "cmf-deployment-github-actions"

# ğŸ–Šï¸ EDIT to set a name for your OpenShift app, or a default one will be generated below.
APP_NAME: "aro-sample-github-action-app"

# ğŸ–Šï¸ EDIT with the port your application should be accessible on.
# If the container image exposes *exactly one* port, this can be left blank.
# Refer to the 'port' input of https://github.com/redhat-actions/oc-new-app
APP_PORT: "8080"

# ğŸ–Šï¸ EDIT to change the image registry settings.
# Registries such as GHCR, Quay.io, and Docker Hub are supported.
IMAGE_REGISTRY: docker.io/{username}
IMAGE_REGISTRY_USER: {username}
IMAGE_REGISTRY_PASSWORD: ${{ secrets.IMAGE_REGISTRY_PASSWORD }}

# ğŸ–Šï¸ EDIT to specify custom tags for the container image, or default tags will be generated below.
IMAGE_TAGS: "latest"

on:
# https://docs.github.com/en/actions/reference/events-that-trigger-workflows
workflow_dispatch:
push:
    # Edit to the branch(es) you want to build and deploy on each push.
    branches: [ "main" ]

jobs:
# ğŸ–Šï¸ EDIT if you want to run vulnerability check on your project before deploying
# the application. Please uncomment the below CRDA scan job and configure to run it in
# your workflow. For details about CRDA action visit https://github.com/redhat-actions/crda/blob/main/README.md
#
# TODO: Make sure to add 'CRDA Scan' starter workflow from the 'Actions' tab.
# For guide on adding new starter workflow visit https://docs.github.com/en/github-ae@latest/actions/using-workflows/using-starter-workflows

openshift-ci-cd:
    # ğŸ–Šï¸ Uncomment this if you are using CRDA scan step above
    # needs: crda-scan
    name: Build and deploy to OpenShift
    runs-on: ubuntu-22.04
    environment: development

    outputs:
    ROUTE: ${{ steps.deploy-and-expose.outputs.route }}
    SELECTOR: ${{ steps.deploy-and-expose.outputs.selector }}

    steps:
    - name: Check for required secrets
    uses: actions/github-script@v6
    with:
        script: |
        const secrets = {
            OPENSHIFT_SERVER: `${{ secrets.OPENSHIFT_SERVER }}`,
            OPENSHIFT_TOKEN: `${{ secrets.OPENSHIFT_TOKEN }}`,
        };

        const GHCR = "ghcr.io";
        if (`${{ env.IMAGE_REGISTRY }}`.startsWith(GHCR)) {
            core.info(`Image registry is ${GHCR} - no registry password required`);
        }
        else {
            core.info("A registry password is required");
            secrets["IMAGE_REGISTRY_PASSWORD"] = `${{ secrets.IMAGE_REGISTRY_PASSWORD }}`;
        }

        const missingSecrets = Object.entries(secrets).filter(([ name, value ]) => {
            if (value.length === 0) {
            core.error(`Secret "${name}" is not set`);
            return true;
            }
            core.info(`âœ”ï¸ Secret "${name}" is set`);
            return false;
        });

        if (missingSecrets.length > 0) {
            core.setFailed(`âŒ At least one required secret is not set in the repository. \n` +
            "You can add it using:\n" +
            "GitHub UI: https://docs.github.com/en/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository \n" +
            "GitHub CLI: https://cli.github.com/manual/gh_secret_set \n" +
            "Also, refer to https://github.com/redhat-actions/oc-login#getting-started-with-the-action-or-see-example");
        }
        else {
            core.info(`âœ… All the required secrets are set`);
        }

    - name: Check out repository
    uses: actions/checkout@v4

    - name: Set up .NET
    uses: actions/setup-dotnet@v2
    with:
        dotnet-version: '8.0.x'  

    - name: Determine app name
    if: env.APP_NAME == ''
    run: |
        echo "APP_NAME=$(basename $PWD)" | tee -a $GITHUB_ENV

    - name: Determine image tags
    if: env.IMAGE_TAGS == ''
    run: |
        echo "IMAGE_TAGS=latest ${GITHUB_SHA::12}" | tee -a $GITHUB_ENV

    # https://github.com/redhat-actions/buildah-build#readme
    - name: Build from Dockerfile
    id: build-image
    uses: redhat-actions/buildah-build@v2
    with:
        image: ${{ env.APP_NAME }}
        tags: ${{ env.IMAGE_TAGS }}

        # If you don't have a Dockerfile/Containerfile, refer to https://github.com/redhat-actions/buildah-build#scratch-build-inputs
        # Or, perform a source-to-image build using https://github.com/redhat-actions/s2i-build
        # Otherwise, point this to your Dockerfile/Containerfile relative to the repository root.
        dockerfiles: |
        ./Dockerfile

    # https://github.com/redhat-actions/push-to-registry#readme
    - name: Push to registry
    id: push-image
    uses: redhat-actions/push-to-registry@v2
    with:
        image: ${{ steps.build-image.outputs.image }}
        tags: ${{ steps.build-image.outputs.tags }}
        registry: ${{ env.IMAGE_REGISTRY }}
        username: ${{ env.IMAGE_REGISTRY_USER }}
        password: ${{ env.IMAGE_REGISTRY_PASSWORD }}

    # The path the image was pushed to is now stored in ${{ steps.push-image.outputs.registry-path }}

    - name: Install oc
    uses: redhat-actions/openshift-tools-installer@v1
    with:
        oc: 4

    # https://github.com/redhat-actions/oc-login#readme
    - name: Log in to OpenShift
    uses: redhat-actions/oc-login@v1
    with:
        openshift_server_url: ${{ env.OPENSHIFT_SERVER }}
        openshift_token: ${{ env.OPENSHIFT_TOKEN }}
        insecure_skip_tls_verify: true
        namespace: ${{ env.OPENSHIFT_NAMESPACE }}

    # This step should create a deployment, service, and route to run your app and expose it to the internet.
    # https://github.com/redhat-actions/oc-new-app#readme
    - name: Create and expose app
    id: deploy-and-expose
    uses: redhat-actions/oc-new-app@v1
    with:
        app_name: ${{ env.APP_NAME }}
        image: ${{ steps.push-image.outputs.registry-path }}
        namespace: ${{ env.OPENSHIFT_NAMESPACE }}
        port: ${{ env.APP_PORT }}

    - name: Print application URL
    env:
        ROUTE: ${{ steps.deploy-and-expose.outputs.route }}
        SELECTOR: ${{ steps.deploy-and-expose.outputs.selector }}
    run: |
        [[ -n ${{ env.ROUTE }} ]] || (echo "Determining application route failed in previous step"; exit 1)
        echo
        echo "======================== Your application is available at: ========================"
        echo ${{ env.ROUTE }}
        echo "==================================================================================="
        echo
        echo "Your app can be taken down with: \"oc delete all --selector='${{ env.SELECTOR }}'\""
----
+
ì°¸ê³ : ì´ í…œí”Œë¦¿ì€ .NET ì•± ì „ìš©ì…ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•ì— ë”°ë¼ í…œí”Œë¦¿ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
+
image:./images/image56.png[]
+
7. ë³€ê²½ ì‚¬í•­ì„ ì»¤ë°‹í•˜ì§€ë§ˆì í•´ë‹¹ ì‘ì—…ì´ ì‹œì‘ë˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë©ë‹ˆë‹¤.
+
image:./images/image57.png[]
+
image:./images/image58.png[]

=== 6.4 Azure DevOpsë¥¼ ì‚¬ìš©í•˜ì—¬ AROì—ì„œ ì»¨í…Œì´ë„ˆí™” ëœ ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„

Microsoft Azure DevOpsë¥¼ ì‚¬ìš©í•˜ì—¬ Red Hat OpenShiftì— ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ ì„¤ì •í•˜ëŠ” ëª¨ë“  ë‹¨ê³„ë¥¼ ì‚´í´ë´…ë‹ˆë‹¤.

image:./images/image59.png[]

**í•„ìˆ˜ ì¡°ê±´**

* GitHub ê³„ì •
* Azure êµ¬ë…
* Red Hat OpenShift í´ëŸ¬ìŠ¤í„°
* Azure DevOpsì— ëŒ€í•œ ì•¡ì„¸ìŠ¤

1. ADO ì¡°ì§ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.
+
image:./images/image60.png[]
+
2. OpenShift í™•ì¥ í”„ë¡œê·¸ë¨ ì„¤ì¹˜
+
ë§ˆì¼“í”Œë ˆì´ìŠ¤[ì—¬ê¸°] ( https://marketplace.visualstudio.com/items?itemName=redhat.openshift-vsts )ì—ì„œ ë¬´ë£Œë¡œ ë°›ê¸°ë¥¼ í´ë¦­í•˜ê³  ì¡°ì§ì— ì„¤ì¹˜í•©ë‹ˆë‹¤.
+
image:./images/image61.png[]
+
image:./images/image62.png[]
+
3. ì„œë¹„ìŠ¤ ì—°ê²° ìƒì„±
+
Microsoft Azure DevOpsë¥¼ OpenShift í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°í•˜ë ¤ë©´ OpenShift ì„œë¹„ìŠ¤ ì—°ê²°ì„ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
+
. Click on Project settingsë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
. Service Connectionsë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
. OpenShiftë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
+
image:./images/image63.png[]
+
ì›í•˜ëŠ” ì¸ì¦ ë°©ì‹(Basic, Token or No authentication)ì„ ì„ íƒí•©ë‹ˆë‹¤. ê¸°ì¡´ OpenShift í´ëŸ¬ìŠ¤í„°ì—ì„œ ì„œë²„ URLê³¼ API í† í°ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
+
image:./images/image64.png[]
+
4. íŒŒì´í”„ë¼ì¸ ìƒì„±:
+
íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
+
image:./images/image65.png[]
+
`Create Pipeline` ì„ í´ë¦­í•©ë‹ˆë‹¤. ì½”ë“œê°€ GitHubì— ìˆìœ¼ë¯€ë¡œ GitHub ì˜µì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
+
image:./images/image66.png[]
+
ê·¸ëŸ° ë‹¤ìŒ Azure Pipelinesë¥¼ ìŠ¹ì¸í•©ë‹ˆë‹¤. ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì„ íƒí•˜ë¼ëŠ” ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.
+
image:./images/image67.png[]
+
image:./images/image68.png[]
+
GitHubì— ëŒ€í•œ ì—°ê²°ì´ ìŠ¹ì¸ë˜ë©´ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ê³  Starter íŒŒì´í”„ë¼ì¸ì„ ì„ íƒí•©ë‹ˆë‹¤.
+
image:./images/image69.png[]
+
`Show assistant` ë¥¼ í´ë¦­í•˜ê³  `Execute oc` ë¥¼ ì„ íƒí•˜ì—¬ OC ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
+
image:./images/image70.png[]
+
image:./images/image71.png[]
+
ê·¸ëŸ° ë‹¤ìŒ `Add` ë¥¼ í´ë¦­í•©ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì— ëŒ€í•´ì„œë„ ê°™ì€ ë‹¨ê³„ë¥¼ ë°˜ë³µí•©ë‹ˆë‹¤. ì°¸ê³ ìš©ìœ¼ë¡œ ì²¨ë¶€ëœ í…œí”Œë¦¿ì„ í™•ì¸í•˜ì„¸ìš”.
+
----
        Starter Template:
        -----------------

        trigger:
        -Â main

        pool:
        Â Â vmImage:Â ubuntu-latest

        steps:

        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ projectÂ ado-pipeline-project'
        Â Â displayName:Â 'SelectÂ Project'
        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ deleteÂ buildconfigÂ ado-openshift-app'
        Â Â displayName:Â 'CleanupÂ oldÂ BuildÂ Config'
        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ deleteÂ deploymentÂ ado-openshift-app'
        Â Â displayName:Â 'CleanupÂ oldÂ Deployment'
        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ deleteÂ serviceÂ ado-openshift-app'
        Â Â displayName:Â 'CleanupÂ oldÂ Service'

        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ deleteÂ routeÂ ado-openshift-app'
        Â Â displayName:Â 'CleanupÂ oldÂ Route'
        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ deleteÂ imagestreamÂ ado-openshift-appÂ -nÂ ado-pipeline-project'
        Â Â displayName:Â 'CleanupÂ oldÂ ImageÂ Stream'Â Â 
        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ new-appÂ openshift/dotnet:7.0-ubi8~https://github.com/panchsan/ado-pipeline-openshift.gitÂ --name=ado-openshift-appÂ --context-dir=MyDotnetOpenshiftApp'
        Â Â displayName:Â 'StartÂ NewÂ Deployment'
        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ exposeÂ svc/ado-openshift-app'
        Â Â displayName:Â 'ExposeÂ service'
        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ logsÂ -fÂ buildconfig/ado-openshift-app'
        Â Â displayName:Â 'GetÂ BuildÂ Logs'
        -Â task:Â oc-cmd@3
        Â Â inputs:
        Â Â Â Â connectionType:Â 'OpenShiftÂ ConnectionÂ Service'
        Â Â Â Â openshiftService:Â 'openshift-ado-service-connection'
        Â Â Â Â cmd:Â 'ocÂ status'
        Â Â displayName:Â 'VerifyÂ Rollout'
----
+
íŒŒì´í”„ë¼ì¸ì„ ì €ì¥í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.
+
image:./images/image72.png[]
+
í•´ë‹¹ ì‘ì—…ì— ì ‘ê·¼í•˜ì—¬ í™•ì¸í•©ë‹ˆë‹¤.
+
image:./images/image73.png[]
+
5. ë°°í¬ í™•ì¸
+
OpenShift í´ëŸ¬ìŠ¤í„°ì— ë¡œê·¸ì¸í•˜ê³  OpenShift í´ëŸ¬ìŠ¤í„°ì—ì„œ ë°°í¬ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
+
image:./images/image74.png[]
+
image:./images/image75.png[]

== 7. ë¶€ë¡

* https://docs.openshift.com/en/container-platform/4.7/cli_reference/openshift_cli/getting-started-cli.html[OpenShift CLI ì‹œì‘í•˜ê¸° - OpenShift CLI(oc) | CLI ë„êµ¬ | OpenShift Container Platform 4.7]
* https://docs.openshift.com/en/container-platform/4.9/cicd/pipelines/using-tekton-hub-with-openshift-pipelines.html[OpenShift íŒŒì´í”„ë¼ì¸ê³¼ í•¨ê»˜ Tekton Hub ì‚¬ìš© - íŒŒì´í”„ë¼ì¸ | CI/CD | OpenShift ì»¨í…Œì´ë„ˆ í”Œë«í¼ 4.9]
* https://www.redhat.com/en/blog/deploying-to-openshift-using-github-actions[GitHub Actionsë¥¼ ì‚¬ìš©í•˜ì—¬ OpenShiftì— ë°°í¬(redhat.com)]
* https://github.com/Azure/ARO-Landing-Zone-Accelerator/blob/main/deployment/CLI/09%20appdeployment/app.azcli[ARO-Landing-Zone-Accelerator/deployment/CLI/09 appdeployment/app.azcli at main Â· Azure/ARO-Landing-Zone-Accelerator (github.com)]